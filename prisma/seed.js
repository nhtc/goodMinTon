const { PrismaClient } = require('@prisma/client')

const prisma = new PrismaClient()

async function main() {
  console.log('üå± Starting database seeding...')

  try {
    // Clear existing data (optional - remove if you want to keep existing data)
    console.log('üóëÔ∏è Clearing existing data...')
    await prisma.personalEventParticipant.deleteMany()
    await prisma.gameParticipant.deleteMany()
    await prisma.personalEvent.deleteMany()
    await prisma.game.deleteMany()
    await prisma.member.deleteMany()

    // Create Members
    console.log('üë• Creating members...')
    const members = await Promise.all([
      prisma.member.create({
        data: {
          name: 'Nguy·ªÖn VƒÉn An',
          phone: '0901234567',
          avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'Tr·∫ßn Th·ªã B√¨nh',
          phone: '0987654321',
          avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b55c?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'L√™ Ho√†ng C∆∞·ªùng',
          phone: '0912345678',
          avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'Ph·∫°m Th·ªã Dung',
          phone: '0923456789',
          avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'Ho√†ng Minh Tu·∫•n',
          phone: '0934567890',
          avatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'V≈© Th·ªã Lan',
          phone: '0945678901',
          avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face',
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'ƒê·ªó VƒÉn Minh',
          phone: '0956789012',
          avatar: null, // Some members without avatar
          isActive: true,
        },
      }),
      prisma.member.create({
        data: {
          name: 'B√πi Th·ªã Nga',
          phone: '0967890123',
          avatar: 'https://images.unsplash.com/photo-1527980965255-d3b416303d12?w=150&h=150&fit=crop&crop=face',
          isActive: false, // Inactive member
        },
      }),
    ])

    console.log(`‚úÖ Created ${members.length} members`)

    // Create Games
    console.log('üè∏ Creating games...')
    const games = []
    
    // Game 1 - Recent game
    const game1 = await prisma.game.create({
      data: {
        date: new Date('2025-09-25T18:00:00'),
        location: 'S√¢n c·∫ßu l√¥ng Thanh Xu√¢n',
        yardCost: 200000,
        shuttleCockQuantity: 3,
        shuttleCockPrice: 45000,
        otherFees: 20000,
        totalCost: 355000,
        costPerMember: 59167,
        costPerGame: 118334,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-25T20:30:00'),
              prePaid: 20000,
              prePaidCategory: 'S√¢n c·∫ßu l√¥ng',
              customAmount: 60000,
            },
            {
              member: { connect: { id: members[1].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-25T21:00:00'),
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 59167,
            },
            {
              member: { connect: { id: members[2].id } },
              hasPaid: false,
              prePaid: 15000,
              prePaidCategory: 'C·∫ßu l√¥ng',
              customAmount: 59167,
            },
            {
              member: { connect: { id: members[3].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-26T08:00:00'),
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 59167,
            },
            {
              member: { connect: { id: members[4].id } },
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 59167,
            },
            {
              member: { connect: { id: members[5].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-25T19:45:00'),
              prePaid: 10000,
              prePaidCategory: 'Kh√°c',
              customAmount: 59167,
            },
          ],
        },
      },
    })
    games.push(game1)

    // Game 2 - Last week
    const game2 = await prisma.game.create({
      data: {
        date: new Date('2025-09-20T19:00:00'),
        location: 'S√¢n c·∫ßu l√¥ng C·∫ßu Gi·∫•y',
        yardCost: 180000,
        shuttleCockQuantity: 2,
        shuttleCockPrice: 45000,
        otherFees: 15000,
        totalCost: 285000,
        costPerMember: 57000,
        costPerGame: 114000,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-20T21:30:00'),
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 57000,
            },
            {
              member: { connect: { id: members[2].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-21T10:00:00'),
              prePaid: 20000,
              prePaidCategory: 'S√¢n c·∫ßu l√¥ng',
              customAmount: 57000,
            },
            {
              member: { connect: { id: members[4].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-20T22:00:00'),
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 57000,
            },
            {
              member: { connect: { id: members[5].id } },
              hasPaid: true,
              paidAt: new Date('2025-09-20T20:15:00'),
              prePaid: 15000,
              prePaidCategory: 'C·∫ßu l√¥ng',
              customAmount: 57000,
            },
            {
              member: { connect: { id: members[6].id } },
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
              customAmount: 57000,
            },
          ],
        },
      },
    })
    games.push(game2)

    console.log(`‚úÖ Created ${games.length} games`)

    // Create Personal Events
    console.log('üéâ Creating personal events...')
    const personalEvents = []

    // Personal Event 1 - Team Building
    const event1 = await prisma.personalEvent.create({
      data: {
        title: 'Team Building Cu·ªëi NƒÉm 2025',
        description: 'S·ª± ki·ªán team building t·∫°i resort S√≥c S∆°n, bao g·ªìm c√°c ho·∫°t ƒë·ªông vui ch∆°i, ƒÉn u·ªëng v√† ngh·ªâ ng∆°i.',
        date: new Date('2025-12-15T09:00:00'),
        location: 'Resort S√≥c S∆°n, H√† N·ªôi',
        totalCost: 2400000,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              customAmount: 400000,
              hasPaid: true,
              paidAt: new Date('2025-09-26T14:30:00'),
              prePaid: 100000,
              prePaidCategory: 'Team Building',
            },
            {
              member: { connect: { id: members[1].id } },
              customAmount: 400000,
              hasPaid: false,
              prePaid: 150000,
              prePaidCategory: 'Team Building',
            },
            {
              member: { connect: { id: members[2].id } },
              customAmount: 400000,
              hasPaid: true,
              paidAt: new Date('2025-09-25T16:20:00'),
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[3].id } },
              customAmount: 400000,
              hasPaid: false,
              prePaid: 50000,
              prePaidCategory: 'Team Building',
            },
            {
              member: { connect: { id: members[4].id } },
              customAmount: 400000,
              hasPaid: false,
              prePaid: 200000,
              prePaidCategory: 'Team Building',
            },
            {
              member: { connect: { id: members[5].id } },
              customAmount: 400000,
              hasPaid: true,
              paidAt: new Date('2025-09-27T09:15:00'),
              prePaid: 80000,
              prePaidCategory: 'Team Building',
            },
          ],
        },
      },
    })
    personalEvents.push(event1)

    // Personal Event 2 - Birthday Party
    const event2 = await prisma.personalEvent.create({
      data: {
        title: 'Sinh Nh·∫≠t Anh C∆∞·ªùng',
        description: 'Ti·ªác sinh nh·∫≠t t·∫°i nh√† h√†ng, ƒÉn u·ªëng v√† karaoke.',
        date: new Date('2025-10-05T18:30:00'),
        location: 'Nh√† h√†ng Ngon Garden, Hai B√† Tr∆∞ng',
        totalCost: 1800000,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              customAmount: 300000,
              hasPaid: true,
              paidAt: new Date('2025-09-26T11:00:00'),
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[1].id } },
              customAmount: 300000,
              hasPaid: false,
              prePaid: 100000,
              prePaidCategory: 'Sinh nh·∫≠t',
            },
            {
              member: { connect: { id: members[2].id } }, // Birthday boy - no payment needed
              customAmount: 0,
              hasPaid: true,
              paidAt: new Date('2025-09-26T11:00:00'),
              prePaid: 0,
              prePaidCategory: 'Ng∆∞·ªùi ƒë∆∞·ª£c m·ª´ng',
            },
            {
              member: { connect: { id: members[3].id } },
              customAmount: 300000,
              hasPaid: true,
              paidAt: new Date('2025-09-26T15:30:00'),
              prePaid: 50000,
              prePaidCategory: 'Sinh nh·∫≠t',
            },
            {
              member: { connect: { id: members[4].id } },
              customAmount: 300000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[5].id } },
              customAmount: 300000,
              hasPaid: false,
              prePaid: 75000,
              prePaidCategory: 'Sinh nh·∫≠t',
            },
            {
              member: { connect: { id: members[6].id } },
              customAmount: 300000,
              hasPaid: true,
              paidAt: new Date('2025-09-27T08:45:00'),
              prePaid: 0,
              prePaidCategory: '',
            },
          ],
        },
      },
    })
    personalEvents.push(event2)

    // Personal Event 3 - Weekend Trip
    const event3 = await prisma.personalEvent.create({
      data: {
        title: 'Du L·ªãch Sapa Cu·ªëi Tu·∫ßn',
        description: 'Chuy·∫øn du l·ªãch 2 ng√†y 1 ƒë√™m t·∫°i Sapa, tham quan v√† tr·∫£i nghi·ªám vƒÉn h√≥a ƒë·ªãa ph∆∞∆°ng.',
        date: new Date('2025-11-08T07:00:00'),
        location: 'Sapa, L√†o Cai',
        totalCost: 3200000,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              customAmount: 800000,
              hasPaid: false,
              prePaid: 300000,
              prePaidCategory: 'Du l·ªãch',
            },
            {
              member: { connect: { id: members[1].id } },
              customAmount: 800000,
              hasPaid: false,
              prePaid: 250000,
              prePaidCategory: 'Du l·ªãch',
            },
            {
              member: { connect: { id: members[3].id } },
              customAmount: 800000,
              hasPaid: false,
              prePaid: 400000,
              prePaidCategory: 'Du l·ªãch',
            },
            {
              member: { connect: { id: members[5].id } },
              customAmount: 800000,
              hasPaid: false,
              prePaid: 200000,
              prePaidCategory: 'Du l·ªãch',
            },
          ],
        },
      },
    })
    personalEvents.push(event3)

    // Personal Event 4 - Dinner
    const event4 = await prisma.personalEvent.create({
      data: {
        title: 'Ti·ªác T·∫•t Ni√™n CLB',
        description: 'B·ªØa ƒÉn t·ªëi cu·ªëi nƒÉm c·ªßa c√¢u l·∫°c b·ªô c·∫ßu l√¥ng.',
        date: new Date('2025-12-28T19:00:00'),
        location: 'Nh√† h√†ng Th·ªßy T·∫°, H·ªì T√¢y',
        totalCost: 1600000,
        participants: {
          create: [
            {
              member: { connect: { id: members[0].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[1].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[2].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 50000,
              prePaidCategory: 'T·∫•t ni√™n',
            },
            {
              member: { connect: { id: members[3].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[4].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 100000,
              prePaidCategory: 'T·∫•t ni√™n',
            },
            {
              member: { connect: { id: members[5].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
            {
              member: { connect: { id: members[6].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 75000,
              prePaidCategory: 'T·∫•t ni√™n',
            },
            {
              member: { connect: { id: members[7].id } },
              customAmount: 200000,
              hasPaid: false,
              prePaid: 0,
              prePaidCategory: '',
            },
          ],
        },
      },
    })
    personalEvents.push(event4)

    console.log(`‚úÖ Created ${personalEvents.length} personal events`)

    // Summary
    console.log('\nüéä Database seeding completed successfully!')
    console.log('üìä Summary:')
    console.log(`   üë• Members: ${members.length}`)
    console.log(`   üè∏ Games: ${games.length}`)
    console.log(`   üéâ Personal Events: ${personalEvents.length}`)
    console.log('\nüí° You can now test your application with realistic data!')
    
  } catch (error) {
    console.error('‚ùå Error during seeding:', error)
    throw error
  }
}

main()
  .catch((e) => {
    console.error('‚ùå Seed script failed:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })